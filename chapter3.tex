%chapter 3 -- draft
\chapter{Этапы запуска и останова системы}
Информация ниже относится только к системам основанным на Ubuntu.
\section{Запуск}
В момент загрузки контроль за ней переходит к Upstart после того как отработает iniramfs (инициализирует 
RAID, монтирует зашифрованные ФС и т.д.). Далее среда initramfs вызывает утилиту \filepath{sbin/init}, которая является главным исполняемым файлом Upstart и она запускает его, присваивая PID равный единице.

В дальнейшем будет предполагаться, что запуск происходит в среде с уровнем исполнения 2. \begin{enumerate}
\item Upstart производит внутренние инициализации.
\item Далее он посылает событие \event{startup}.

Это событие является триггером для дальнейших инициализаций.
\item Далее запускается небольшое количество сервисов, которые сконфигурированы запускаться от события \event{startup}. Наибольшее значение из них имеет сервис mountall, который монтирует все диски и дисковые разделы.
\item В свою очередь сервис mountall генерирует несколько событий. В их число входят события \event{local--filesystems}, \event{virtual--filesystems} и \event{all-swaps}. За дополнительной информацией обращайтесь к справочному руководству по upstart--events.
\item Событие \event{virtual--filesystems} побуждает запуститься udev. В свою очередь, запуск udev служит сигналом к запуску сервиса upstart-udev-bridge.
\item Сервис upstart-udev-bridge генерирует событие--метод \event{net--device--up IFACE=lo}, сигнализируя 
что локальный сетевой интерфейс доступен.
\item После того как смонтирована последняя файловая система, сервис mountall генерирует событие \event{filesystem}.
\item После этого стартует сервис rc-sysinit по условию \stanza{start on}{filesystem and net--device--up IFACE=lo}.
\item rc-sysinit вызывает команду telinit 2 для переключения на уровень выполнения 2. После чего сервис telinit шлёт метод с параметрами \event{runlevel RUNLEVEL=2 PREVLEVEL=N}. Для более подробных сведений смотрите раздел \ref{sec:runlevel}
\item Событие \event{runlevel} служит сигналом к запуску множества других сервисов, включая и \filepath{/etc/init/rc.conf} для совместимости с со старыми сервисами в стиле System V.
\end{enumerate}
\section{Выключение}
Следует усвоить основные положения относящиеся к завершению работы системы под управлением Upstart: \begin{itemize}
\item Upstart никогда не завершает работу сам по себе. Он "умирает" только по факту отключения питания, 
всякое иное поведение должно считаться багом.
\item Upstart никогда не будет выключать сервис не имеющий инструкции stop on.
\item Ubuntu взаимодействует с обоими типами сервисов: и Upstart, и System V.
\end{itemize}

Рассмотрим теперь подробнее действия Upstart при останове системы, предполагается, что текущий runlevel равен 2: \begin{enumerate}
\item Upstart посылает событие \event{runlevel RUNLEVEL=0 PREVLEVEL=2}.
\item Далее запускается сервис \filepath{/etc/init/rc.conf}, который в свою очередь исполняет сценарий \filepath{/etc/init.d/rc}.
\item Этот сценарий выполняет имеющиеся скрипты в директории \filepath{/etc/rc0.d/} для остановки сервисов System V.
\item Далее запускается сценарий \filepath{/etc/init.d/sendsigs}, этот сценарий убивает все еще не остановившиеся сервисы, включая сервисы Upstart.
\end{enumerate}
\section{Перезапуск}
Предположим, что так или иначе была инициирован перезапуск системы, в этом случае Upstart